.. _coding-merging_rules:
.. vim: syntax=rst
.. vim: textwidth=72
.. vim: spell spelllang=ru,en

======================
Сливание (merge) веток
======================

Включать изменения между ветками можно двумя способами:

* используя cherry-pick;
* используя merge.

Merge имеют множество преимуществ. Главное различие между ними:
merge работает на уровне веток, а cherry-pick на уровне коммитов. Это
означает что merge может переместить изменения как с одного, десяти
или тысячи коммитов с одинаковой лёгкостью. Merge-и также и легче
понять, так как коммит merge-а это "обещание" что все изменения с
его родителей будут включены.

Однако, сам merge бывает двух видов:

* fast-forward;
* true merge.

Fast-forward может использоваться когда на данный момент нет текущих
изменений в ветке и хочется обновить её, как правило, откуда-то из вне.
Так как никаких изменений/коммитов для данного случая не требуется,
то работа этого режима заключается в исправлении ссылки ветки на более
новый коммит. При этом, никаких изменений в истории видно не будет,
кроме того, что указатель ветки будет объединён у веток.

True merge означает реальное создание коммита, имеющего несколько
родителей. При этом в истории будет виден и коммит и факт соития
веток вместе.

Имеется проблема: Git никак не следит за изменениями между ссылками
веток. То есть понять кто когда произвёл fast-forward слияние веток
не представляется возможным -- лишь только косвенными методами
по времени сообщения оповещения о данном факте. Если производится
fast-forward, то, не смотря на создание отдельной ветки, история
коммитов линеализируется:

::

  --*--+                         <-- master
        \
         +--*----*----*----*---  <-- dev-branch

Превратиться в:

::

  --*-------*----*----*----*---  <-- master

Так как всё основано только на зависимостях между parent и child.

А в master ветке хочется видеть реально исключительно работоспособные
коммиты в любом временном срезе -- не видеть коммитов исключительно
характера development.

Поэтому предлагается ввести следующие правила:

* Во нижестоящие ветки **ЖЕЛАТЕЛЬНО** производить только true merge
  из вышестоящих. Под вышестоящими предполагаются ветки созданные
  как ответвление от более ранних. Если каждый commit из вышестоящей
  ветки является самодостаточным и логически завершённым, то можно
  производить и fast-forward конечно же.
* В master производится **ОБЯЗАТЕЛЬНО** true merge, за исключением
  одинарных атомарных логически завершённых коммитов, собственно для
  которых и нет надобности создавать отдельную ветку в принципе.
* Из нижестоящих веток в вышестоящие **ЖЕЛАТЕЛЬНО** делать fast-forward:
  то есть "подтягивая" изменения из master-а, обновляясь с удалённых
  репозиториев.
