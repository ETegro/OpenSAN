.. _remotetesting-api:

==========
API тестов
==========
* Запуск тестов производится исполнением **perform.sh**
* Тест сразу же имеет возможность выполнять следующие команды:

  :CMD_SSH:
   В качестве аргумента принимает команды необходимые для запуска на
   удалённой системе
  :CMD_SCP:
   В качестве аргументов принимает путь к файлу который необходимо
   скопировать, и путь к файлу куда скопировать на целевой удалённой
   системе
  :pushdq:
   Аналогично команде *pushd*, только не производящей какой-либо вывод
  :popdq:
   Аналогично команде *popd*, только не производящей какой-либо вывод
  :run_lua:
   В качестве аргумента передаётся имя Lua-скрипта содержащего методы
   Luaunit теста. Имя без расширения. Имя является путём относительно
   текущей рабочей директории. Данный скрипт дополняется подключением
   всем astor2 библиотек, luaunit библиотеки, а также вызовом самих
   тестов внутри скрипта. Скрипт загружается на удалённую систему и
   исполняется
  :run_clearing:
   Выполняется удалённое выполнения скрипта полной очистки конфигурации
   системы
  :iqns_get:
   Выдача списка всех доступных IQN-ов на удалённой системе
  :iqn_login:
   В качестве аргумента передаётся строка из *iqns_get* и производится
   авторизованное подключение удалённого накопителя
  :iqn_logout:
   В качестве аргумента передаётся строка из *iqns_get* и производится
   отключение удалённого накопителя
  :iqns_stop_all:
   Отключение и останов всех имеющихся на локальной системе iSCSI
   target-ов
  :iqns_start_all:
   Подключение всех доступных на удалённой системе iSCSI target-ов
  :devs_get:
   Выдача списка всех доступных блоковых устройств являющихся iSCSI
   устройствами
  :dd_run:
   Запуск утилиты dd с источником */dev/zero* и размером блока равным 1
   MiB с назначением являющимся блоковым устройством передающимся первым
   аргументом
  :save_log:
   В качестве аргумента принимает удобо-человеко-читаемое название некой
   подстадии, которая будет представлять из себя файл в директории с
   сохранёнными результатами. В данную функцию также необходима передача
   данных требуемых для сохранения в stdin, которые будут добавлены в
   конец файла-подстадии
  :failed:
   В качестве аргумента принимает сообщение-комментарий о причине
   падения теста. Функция требуется для останова процесса тестирования с
   указанием причины

* Тест имеет следующие переменные окружения доступные:

  :SSH:
   Команда вызова SSH
  :SCP:
   Команда вызова SCP утилиты
  :ISCSIADM:
   Команда вызова iscsiadm
  :DD:
   Команда вызова утилиты dd
  :FIO:
   Команда вызова утилиты fio
  :WORK_DIR:
   Рабочая директория всего framework-а тестирования

* Сохранение результатов (посредством команды *log_save*) производится в
  директорию **results/YYYY-MM-DD_HH:MM/test_name/substage**, где:

  :YYYY-MM-DD_HH\:MM:
   Дата и время на момент запуска *perform.sh*
  :test_name:
   Имя теста
  :substage:
   Имя подстадии / аргумента передающегося *save_log*-у
