<%#
 aStor2 -- storage area network configurable via Web-interface
 Copyright (C) 2009-2011 ETegro Technologies, PLC
                         Vladimir Petukhov (vladimir.petukhov@etegro.com)
 
 This program is free software: you can redistribute it and/or modify
 it under the terms of the GNU Affero General Public License as
 published by the Free Software Foundation, either version 3 of the
 License, or (at your option) any later version.
 
 This program is distributed in the hope that it will be useful,
 but WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 GNU Affero General Public License for more details.
 
 You should have received a copy of the GNU Affero General Public License
 along with this program.  If not, see http://www.gnu.org/licenses/.
%>

<td valign="top"
    rowspan="<%= line.logical.rowspan %>"
    class="<%+san/matrix_logical_class%>">

<table border="0px" width="100%" cellpadding="0" cellspacing="0">
	<tr>
		<td>
			<%= line.logical.id %>
		</td>
		<td><%: RAID %> <%= line.logical.level %></td>
		<td><%= line.logical.state %></td>
		<% if line.logical.progress then %>
			<td>(<%= line.logical.progress %> %)</td>
		<% end %>
		<% if #common.keys( line.logical.logical_volumes ) == 0 then %>
			<td>
			<input name="san.submit_logical_delete-<%= line.logical.id %>"
			       onclick=" if ( !confirm( '<%: Really delete logical drive? %>' ) )
					 return false;
					 return true;"
			       src="<%=resource%>/cbi/remove.gif"
			       type="image"
			       title="<%: Remove %>"
			       value="<%: Remove %>" />
			</td>
		<% end %>
	</tr>
	<tr>
		<% local local_colspan = 4
		   if line.logical.progress then
			local_colspan = local_colspan + 1
		   end
		   if #common.keys( line.logical.logical_volumes ) == 0 then
			local_colspan = local_colspan + 1
		end %>
		<td colspan="<%= local_colspan %>">
			<div>
				<span title="<%= line.logical.volume_group.allocated_mib %> <%: MiB %> / <%= line.logical.volume_group.total_mib %> <%: MiB %> (<%= line.logical.volume_group.percentage or "0" %> %)">
					<%= line.logical.volume_group.allocated %> <%: TiB %> / <%= line.logical.volume_group.total %> <%: TiB %> (<%= line.logical.volume_group.percentage or "0" %> %)
				</span>
			</div>
			<div id="new_volume_slider-<%= line.logical.id %>"></div>
			<div class="inline">
				<%: New volume name %>
			</div>
			<div class="inline">
				<input id="san.new_volume_name-<%= line.logical.id %>"
				       name="san.new_volume_name-<%= line.logical.id %>"
				       type="text"
				       value="" />
			</div>
			<div class="inline">
				<input name="san.submit_logical_volume_add-<%= line.logical.id %>-<%= line.logical.volume_group.name %>"
				       src="<%=resource%>/cbi/add.gif"
				       title="<%: Add logical volume %>"
				       type="image"
				       value="<%: Add logical volume %>" />
			</div>
			<div>
				<input id="san.new_volume_slider_size-<%= line.logical.id %>"
				       class="new_volume_slider_size-<%= line.logical.id %>"
				       name="san.new_volume_slider_size-<%= line.logical.id %>"
				       readonly="readonly"
				       type="text"
				       value="0" />
			</div>
			<script type="text/javascript">
				jQuery.noConflict();
				(function($){
					var slider_name = '#new_volume_slider-<%= line.logical.id %>';
					var slider_input_name = '.new_volume_slider_size-<%= line.logical.id %>';
					$( slider_name ).slider({
						orientation: 'horizontal',
						min: <%= line.logical.volume_group.extent %>,
						max: <%= line.logical.volume_group.total_mib %> - <%= line.logical.volume_group.allocated_mib %>,
						range: 'min',
						value: ( <%= line.logical.volume_group.total_mib %> - <%= line.logical.volume_group.allocated_mib %> ) / 2,
						step: <%= line.logical.volume_group.extent %>,
						slide: function( event, ui ) {
							$( slider_input_name ).val( ui.value );
						}
					});
					$( slider_input_name )
						.val( $( slider_name )
						.slider( 'value' ) );
				})(jQuery);
			</script>
		</td>
	</tr>
</table>

</td>
