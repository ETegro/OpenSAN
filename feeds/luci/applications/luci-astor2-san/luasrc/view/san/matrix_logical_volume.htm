<%#
 aStor2 -- storage area network configurable via Web-interface
 Copyright (C) 2009-2011 ETegro Technologies, PLC
                         Vladimir Petukhov (vladimir.petukhov@etegro.com)
 
 This program is free software: you can redistribute it and/or modify
 it under the terms of the GNU Affero General Public License as
 published by the Free Software Foundation, either version 3 of the
 License, or (at your option) any later version.
 
 This program is distributed in the hope that it will be useful,
 but WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 GNU Affero General Public License for more details.
 
 You should have received a copy of the GNU Affero General Public License
 along with this program.  If not, see http://www.gnu.org/licenses/.
%>

<td valign="top"
    rowspan="<%= line.logical_volume.rowspan %>"
    class="<%+san/matrix_logical_volume_class%>">

<table border="0px" width="100%" cellpadding="0" cellspacing="0">
	<tr>
		<% local access_pattern_exists = false %>
		<% local logical_volume_is_binded = false %>
		<% for _, line_ap in ipairs( matrix_overall.lines ) do %>
			<% if line_ap.access_pattern then %>
				<% access_pattern_exists = true %>
				<% if line_ap.access_pattern:is_binded() then %>
					<% if line_ap.access_pattern.filename == line.logical_volume.device then %>
						<% logical_volume_is_binded = true %>
					<% end %>
				<% end %>
			<% end %>
		<% end %>
		<% if #line.logical_volume.snapshots ~= 0 then %>
			<% for _, snapshot in ipairs ( line.logical_volume.snapshots ) do %>
				<% for _, line_ap in ipairs( matrix_overall.lines ) do %>
					<% if line_ap.access_pattern then %>
						<% if line_ap.access_pattern:is_binded() then %>
							<% if line_ap.access_pattern.filename == snapshot.device then %>
								<% logical_volume_is_binded = true %>
							<% end %>
						<% end %>
					<% end %>
				<% end %>
			<% end %>
		<% end %>
		<td>
			<%= line.logical_volume.name %>
		</td>
		<td>
			<span title="<%= line.logical_volume.size_mib %> <%: MiB %>">
				<%= line.logical_volume.size %> <%: TiB %>
			</span>
		</td>
		<td>
			<% if not logical_volume_is_binded then %>
				<%+san/matrix_logical_volume_remove%>
			<% end %>
		</td>
		<td>
			<% if access_pattern_exists then %>
				<input name="san.logical_volume_select"
				       type ="radio"
				       value="<%= line.logical_volume.device %>" />
			<% end %>
		</td>
	</tr>
	<tr>
		<td colspan="4">
			<% if #line.logical_volume.snapshots == 0 then %>
				<%+san/matrix_logical_volume_resizing%>
			<% end %>
			<a id="volume_logical_info-<%= sha1( line.logical_volume.name ) %>"
			   href="#"
			   class="inline">
				<img src="<%=resource%>/cbi/fieldadd.gif"
				     alt="<%: Snapshot %>"
				     title="<%: Snapshot %>" />
			</a>
		</td>
	</tr>
	<tr class="to_hide">
		<td colspan="3">
			<%+san/matrix_logical_volume_snapshot_taking%>
		</td>
	</tr>
</table>

</td>
