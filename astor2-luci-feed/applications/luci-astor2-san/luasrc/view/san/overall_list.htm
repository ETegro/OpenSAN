<form method="post" action="<%=luci.dispatcher.build_url("san", "san_functions")%>">

<table border="1px" bordercolor="#ccc" cellpadding="0" cellspacing="0">
	<tr>
		<td>Physical list</td>
		<td>Logical list</td>
	</tr>
	<% for _, pair in ipairs( physical_logical_matrix ) do %>
	<tr>
		<td>
			<table border="0px" width="100%" cellpadding="0" cellspacing="0">
				<tr>
					<td class="border-top-left"><input type="checkbox" name="checkbox_drive" value="<%= pair.physical_id %>" /></td>
					<td class="border-top"><%= pair.physical_id %></td>
					<td class="border-top"><%= physicals[ pair.physical_id ].model %></td>
					<td class="border-top"><%= physicals[ pair.physical_id ].size %> MiB</td>
				</tr>
				<tr class="to_hide">
					<td colspan="4" class="border-left">
						<ul>
							<li><tt><%:ID%>: <%= pair.physical_id %></tt></li>
							<li><tt><%:Model%>: <%= physicals[ pair.physical_id ].model %></tt></li>
							<li><tt><%:Serial%>: <%= physicals[ pair.physical_id ].serial %></tt></li>
							<li><tt><%:Revision%>: <%= physicals[ pair.physical_id ].revision %></tt></li>
							<li><tt><%:State%>: <%= physicals[ pair.physical_id ].state %></tt></li>
							<li><tt><%:Size%>: <%= physicals[ pair.physical_id ].size %>MiB</tt></li>
						</ul>
					</td>
				</tr>
			</table>
		</td>
		<% if pair.logical_id then %>
		<td rowspan="<%= pair.logical_size %>" valign="top" class="border-top-right-bottom">
			<table border="0px" width="100%" cellpadding="0" cellspacing="0">
				<tr>
					<td><input type="checkbox" name="checkbox_logical" value="<%= pair.logical_id %>" /></td>
					<td><%= pair.logical_id %></td>
					<td><%:RAID%>: <%= logicals[ pair.logical_id ].level %></td>
					<td><%= logicals[ pair.logical_id ].state %></td>
					<% if logicals[ pair.logical_id ].progress then %>
						<td><%= logicals[ pair.logical_id ].progress %> % </td>
					<% end %>
					<td><%= logicals[ pair.logical_id ].capacity %> MiB </td>
				</tr>
				<tr class="to_hide2">
					<% local colspan_logical
					if logicals[ pair.logical_id ].progress then
						colspan_logical = 6
					else
						colspan_logical = 5
					end %>
					<td colspan="<%= colspan_logical %>">
						<ul>
							<li><tt><%:ID%>: <%= pair.logical_id %></tt</li>
							<li><tt><%:RAID level%>: <%= logicals[ pair.logical_id ].level %></tt</li>
							<li><tt><%:State%>: <%= logicals[ pair.logical_id ].state %></tt</li>
							<li><tt><%:Drives%>: <%= table.concat( logicals[ pair.logical_id ].drives, ", " ) %></tt</li>
							<% if logicals[ pair.logical_id ].progress then %>
								<li><tt><%= logicals[ pair.logical_id ].progress %> % </tt></li>
							<% end %>
							<li><tt><%:Devise%>: <%= logicals[ pair.logical_id ].device %></tt</li>
							<li><tt><%:Size%>: <%= logicals[ pair.logical_id ].capacity %> MiB</tt</li>
						</ul>
						<ul>
							<li><input type="submit" name="submit_einarc" Value="Logical Delete" /></li>
						</ul>
					</td>
				</tr>
			</table>
		</td>
		<% end %>
	</tr>
	<% end %>
</table>

<div id="div_raid_create" class="to_hide">
	<p><%: RAID level %>:
		<select name="raid_level" size="1">
			<% for _, raidlevel in ipairs( raidlevels ) do %>
			<option value="<%= raidlevel %>"><%= raidlevel %></option>
			<% end %>
		</select>
	</p>
	<p>
		<input type="submit" name="submit_einarc" value="Create RAID" />
	</p>
</div>
</form>

<script type="text/javascript">
jQuery.noConflict();
(function($) {

// effects

$( '.to_hide' ).hide();
$( '.to_hide2' ).hide();

$( 'form input:checkbox[ name = "checkbox_drive" ]' ).click( function() {
	if ( $( this ).is( ':checked' ) ) {
		var parent_selector_to_show = $( this ).parent( 'td' ).parent( 'tr' ).next( 'tr:hidden' ).css( 'background-color', 'yellow' )
		$( parent_selector_to_show ).fadeIn( 'fast' );
		$( '#div_raid_create' ).fadeIn( 'fast' );
	} else {
		var parent_selector_to_hide = $( this ).parent( 'td' ).parent( 'tr' ).next( 'tr' ).css( 'background-color', 'red' )
		$( parent_selector_to_hide ).fadeOut( 'fast' );
		if ( $( 'form input:checkbox[ name = "checkbox_drive" ]' ).is( ':checked' ) ) {
		} else {
			$( '#div_raid_create' ).fadeOut( 'fast' );
		}
	}
} );

$( 'form input:checkbox[ name = "checkbox_logical" ]' ).click( function() {
	if ( $( this ).is( ':checked' ) ) {
		var parent_selector_to_show = $( this ).parent( 'td' ).parent( 'tr' ).next( 'tr:hidden' ).css( 'background-color', 'yellow' )
		$( parent_selector_to_show ).fadeIn( 'fast' );
	} else {
		var parent_selector_to_hide = $( this ).parent( 'td' ).parent( 'tr' ).next( 'tr' ).css( 'background-color', 'red' )
		$( parent_selector_to_hide ).fadeOut( 'fast' );
	}
} );

/*$( 'form a[ name = "logical_id_info" ]' ).click( function() {
	var parent_selector = $( this ).parent( 'td' ).parent( 'tr' ).next( 'tr' ).css( 'background-color', 'yellow' );
	if ( $( parent_selector ).is( ':hidden' ) ) {
		$( parent_selector ).fadeIn( 'fast' );
	} else {
		$( parent_selector ).fadeOut( 'fast' );
		}
	}
);*/

//styles

/*
$( 'td.border' ).css( 'background-color', '#f0f' )
$( 'td.border-top-left' ).css( {
	'border-width': '10px 0 0 10px',
	'border-style': 'solid',
	'border-color': '#f0f' } )
$( 'td.border-top' ).css( {
	'border-width': '10px 0 0 0',
	'border-style': 'solid',
	'border-color': '#f0f' } )
$( 'td.border-top-right' ).css( {
	'border-width': '10px 10px 0 0',
	'border-style': 'solid',
	'border-color': '#f0f' } )
$( 'td.border-top-right-bottom' ).css( {
	'border-width': '10px 10px 10px 0',
	'border-style': 'solid',
	'border-color': '#f0f' } )
$( 'td.border-left' ).css( {
	'border-width': '0 0 0 10px',
	'border-style': 'solid',
	'border-color': '#f0f' } )
*/

})(jQuery);
</script>
